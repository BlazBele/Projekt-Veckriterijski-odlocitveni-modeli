{% extends 'base.html' %}

{% block title %}WSM Analiza{% endblock %}

{% block content %}
<h1>WSM Analiza</h1>
<br>

<!-- Korak 1: Izbira podjetij -->
{% if data == 'selection' %}
    <form method="POST">
        <input type="hidden" name="data" value="weights">
        <h2>Izberite podjetja za analizo</h2>
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th><input type="checkbox" id="select_all"></th>
                    <th>ID</th>
                    <th>Podjetje</th>
                    <th>Prihodek</th>
                    <th>Dobiček</th>
                    <th>Sredstva</th>
                    <th>Zaposleni</th>
                </tr>
            </thead>
            <tbody>
                {% for company in companies %}
                <tr>
                    <td><input type="checkbox" class="company-checkbox" name="selected_companies" value="{{ company['uvoz'] }}"></td>
                    <td>{{ company['uvoz'] }}</td>
                    <td>{{ company['podjetje'] }}</td>
                    <td>{{ company['prihodek'] }}</td>
                    <td>{{ company['dobicek'] }}</td>
                    <td>{{ company['sredstva'] }}</td>
                    <td>{{ company['zaposleni'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Naprej</button>
    </form>
{% endif %}

<!-- Korak 2: Vnos uteži -->
{% if data == 'weights' %}
    <form method="POST">
        <input type="hidden" name="data" value="results">
        <h2>Vnesite uteži za dejavnike (v razponu od 0 do 1)</h2>
        <div class="form-group">
            <label for="weight_income">Utež za Prihodek:</label>
            <input type="number" id="weight_income" name="weight_income" min="0" max="1" step="0.01" required class="form-control">
        </div>
        <div class="form-group">
            <label for="weight_profit">Utež za Dobiček:</label>
            <input type="number" id="weight_profit" name="weight_profit" min="0" max="1" step="0.01" required class="form-control">
        </div>
        <div class="form-group">
            <label for="weight_assets">Utež za Sredstva:</label>
            <input type="number" id="weight_assets" name="weight_assets" min="0" max="1" step="0.01" required class="form-control">
        </div>
        <div class="form-group">
            <label for="weight_employees">Utež za Zaposlene:</label>
            <input type="number" id="weight_employees" name="weight_employees" min="0" max="1" step="0.01" required class="form-control">
        </div>
        <button type="submit" class="btn btn-primary mt-3">Izračunaj</button>
    </form>
{% endif %}

<!-- Korak 3: Rezultati WSM analize -->
{% if data == 'results' %}
    <h2>Rezultati WSM analize</h2>
    <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Rang</th>
                <th>Podjetje</th>
                <th>Prihodek</th>
                <th>Dobiček</th>
                <th>Sredstva</th>
                <th>Zaposleni</th>
                <th>WSM Ocena</th>
            </tr>
        </thead>
        <tbody>
            {% for company in companies %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ company['podjetje'] }}</td>
                <td>{{ company['prihodek'] }}</td>
                <td>{{ company['dobicek'] }}</td>
                <td>{{ company['sredstva'] }}</td>
                <td>{{ company['zaposleni'] }}</td>
                <td>{{ company['score'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}

<script>
    // JavaScript za "Select All"
    document.getElementById('select_all').addEventListener('change', function(e) {
        const checkboxes = document.querySelectorAll('.company-checkbox');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = e.target.checked;
        });
    });
</script>

{% endblock %}
