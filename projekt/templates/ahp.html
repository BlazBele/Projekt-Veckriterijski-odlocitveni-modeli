{% extends 'base.html' %}

{% block title %}AHP Analiza{% endblock %}

{% block content %}
<h1>AHP Analiza</h1>
<br>

<!-- Korak 1: Izbira kriterijev -->
{% if data == 'selection' %}
    <form method="POST">
        <input type="hidden" name="data" value="companies">
        <h2>Izberite kriterije za analizo</h2>
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th><input type="checkbox" id="select_all"> Izbira</th>
                    <th>Kriterij</th>
                </tr>
            </thead>
            <tbody>
                {% for criterion in criteria %}
                <tr>
                    <td><input type="checkbox" class="criterion-checkbox" name="selected_criteria" value="{{ criterion }}"></td>
                    <td>{{ criterion }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Naprej</button>
    </form>
{% endif %}

<!-- Korak 2: Izbira podjetij -->
{% if data == 'companies' %}
    <form method="POST">
        <input type="hidden" name="data" value="weights">
        <h2>Izberite podjetja za analizo</h2>
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th><input type="checkbox" id="select_all_companies"> Izbira</th>
                    <th>Podjetje</th>
                </tr>
            </thead>
            <tbody>
                {% for company in companies %}
                <tr>
                    <td><input type="checkbox" class="company-checkbox" name="selected_companies" value="{{ company['uvoz'] }}"></td>
                    <td>{{ company['podjetje'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Naprej</button>
    </form>
{% endif %}

<!-- Korak 3: Vnos parnih primerjav -->
{% if data == 'weights' %}
    <form method="POST">
        <input type="hidden" name="data" value="results">
        <h2>Vnesite parne primerjave kriterijev</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th></th>
                    {% for criterion in session['selected_criteria'] %}
                    <th>{{ criterion }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for i in range(session['selected_criteria']|length) %}
                <tr>
                    <th>{{ session['selected_criteria'][i] }}</th>
                    {% for j in range(session['selected_criteria']|length) %}
                        <td>
                            {% if i == j %}
                                <input type="text" value="1" disabled class="form-control">
                                <input type="hidden" name="pairwise_{{ i }}_{{ j }}" value="1">
                            {% elif i < j %}
                                <input type="text" name="pairwise_{{ i }}_{{ j }}" class="form-control" placeholder="Vrednost">
                            {% else %}
                                <input type="text" value="auto" disabled class="form-control bg-light">
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Izraƒçunaj</button>
    </form>
{% endif %}

<!-- Korak 4: Rezultati AHP analize -->
{% if data == 'results' %}
    <h2>Rezultati AHP analize</h2>
    <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Mesto</th>
                <th>Podjetje</th>
                <th>Ocena</th>
            </tr>
        </thead>
        <tbody>
            {% for company in companies %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ company['podjetje'] }}</td>
                <td>{{ company['score'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}

<script>
    // JavaScript za "Select All"
    document.getElementById('select_all').addEventListener('change', function(e) {
        const checkboxes = document.querySelectorAll('.company-checkbox');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = e.target.checked;
        });
    });
    </script>


{% endblock %}
